<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <link rel="icon" type="png" href="icon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>E-MARKETPLACE</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: linear-gradient(135deg, #f0f4f8, #d9e2ec);
    }
    header {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 15px;
      background: #001f3f; /* navy */
      color: white;
      position: relative;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
    header h1 {
      margin: 0;
      font-size: 24px;
    }
    #cartIcon {
      cursor: pointer;
      position: absolute;
      right: 20px;
      font-size: 20px;
    }
    #cartCount {
      background: red;
      color: white;
      border-radius: 50%;
      padding: 2px 6px;
      font-size: 12px;
      position: absolute;
      top: -8px;
      right: -10px;
    }
    section {
      padding: 20px;
    }
    section h2 {
      margin-bottom: 15px;
      color: #001f3f;
    }
    .products {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
    }
    .product {
      background: white;
      border: 1px solid #ccc;
      border-radius: 12px;
      margin: 5px;
      padding: 10px;
      text-align: center;
      box-shadow: 0 4px 10px rgba(0,0,0,0.08);
      transition: transform 0.2s;
    }
    .product:hover {
      transform: translateY(-5px);
    }
    .product img {
      width: 100%;
      height: 130px;
      object-fit: cover;
      border-radius: 10px;
      margin-bottom: 8px;
    }
    .name {
      font-weight: bold;
      margin: 5px 0;
    }
    .price {
      color: #001f3f;
      margin-bottom: 8px;
    }
    button {
      background: #001f3f;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover {
      background: #004080;
    }
    .qty-box {
      margin-top: 8px;
    }
    .qty-box input {
      width: 50px;
      text-align: center;
      padding: 4px;
      border: 1px solid #aaa;
      border-radius: 6px;
    }
    @media (max-width: 900px) {
      .products {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      }
    }

    /* Modal custom */
    .modal {
      display: none;
      position: fixed;
      z-index: 9999;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.6);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      width: 300px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      animation: fadeIn 0.3s ease;
    }
    .modal-content h3 {
      margin: 0 0 10px;
      color: #001f3f;
    }
    .modal-content p {
      margin: 0 0 15px;
      color: #333;
    }
    @keyframes fadeIn {
      from {opacity: 0; transform: translateY(-20px);}
      to {opacity: 1; transform: translateY(0);}
    }
  </style>
</head>
<body>
  <header>
    <h1>E-MARKETPLACE</h1>
    <div id="cartIcon">ðŸ›’<span id="cartCount">0</span></div>
  </header>

  <!-- Kategori Makanan -->
  <section>
    <h2>Makanan</h2>
    <div class="products" id="foodList"></div>
  </section>

  <!-- Kategori Minuman -->
  <section>
    <h2>Minuman</h2>
    <div class="products" id="drinkList"></div>
  </section>

  <!-- Modal Custom -->
  <div id="loginModal" class="modal">
    <div class="modal-content">
      <h3>Anda Belum Login</h3>
      <p>Silahkan login terlebih dahulu</p>
      <button id="btnLogin">Login Sekarang</button>
    </div>
  </div>

  <script>
    const foods = [
      {id:1, name:'Mochi', price:10000, img:'mochi.png'},
      {id:2, name:'Telor Gulung', price:5000, img:'telor.jpg'},
      {id:3, name:'Mie Ayam', price:12000, img:'mie-ayam.jpg'},
      {id:4, name:'Cimol', price:5000, img:'cimol.png'},
      {id:5, name:'kentang goreng', price:5000, img:'kentang.jpg'},
    ];

    const drinks = [
      {id:6, name:'Es Jeruk', price:6000, img:'es jeruk.jpg'},
      {id:7, name:'Es Teh Tali Pinggir', price:5000, img:'esteh.jpg'},
      {id:8, name:'Jus Alpukat', price:12000, img:'jus.jpeg'},
      {id:9, name:'Jus Kelengkeng', price:10000, img:'jusss.jpg'},
      {id:10, name:'Jus Rambutan', price:10000, img:'juss.jpg'},
    ];

    // gunakan key sama dengan checkout.html
    function getCartKey(){
      return 'cart';
    }

    function renderProducts(list, containerId){
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      const cart = JSON.parse(localStorage.getItem(getCartKey())) || {};

      list.forEach(p=>{
        const div = document.createElement('div');
        div.className = 'product';
        div.innerHTML = `
          <img src="${p.img}" alt="${p.name}">
          <div class="name">${p.name}</div>
          <div class="price">Rp ${p.price.toLocaleString()}</div>
          ${cart[p.id] ? `
            <div class="qty-box">
              <input type="number" min="1" value="${cart[p.id]}" onchange="updateQty(${p.id}, this.value)">
            </div>
          ` : `<button onclick="addToCart(${p.id})">Keranjang</button>`}
        `;
        container.appendChild(div);
      });
    }

    function addToCart(id){
      const cart = JSON.parse(localStorage.getItem(getCartKey())) || {};
      cart[id] = 1;
      localStorage.setItem(getCartKey(), JSON.stringify(cart));
      updateCartCount();
      renderAll();
    }

    function updateQty(id, val){
      const qty = parseInt(val);
      const cart = JSON.parse(localStorage.getItem(getCartKey())) || {};
      if(qty > 0) cart[id] = qty;
      else delete cart[id];
      localStorage.setItem(getCartKey(), JSON.stringify(cart));
      updateCartCount();
    }

    function updateCartCount(){
      const cart = JSON.parse(localStorage.getItem(getCartKey())) || {};
      let total = 0;
      for(let id in cart){ total += cart[id]; }
      document.getElementById('cartCount').innerText = total;
    }

    function renderAll(){
      renderProducts(foods,'foodList');
      renderProducts(drinks,'drinkList');
    }

    document.getElementById('cartIcon').addEventListener('click', ()=>{
      window.location.href = 'checkout.html';
    });

    renderAll();
    updateCartCount();

    // ðŸ”’ Cek login
    window.addEventListener("DOMContentLoaded", () => {
      const userStr = localStorage.getItem("loggedInUser");
      let user = null;

      try {
        user = JSON.parse(userStr);
      } catch (e) {
        user = null;
      }

      if (!user || !user.name) {
        const modal = document.getElementById("loginModal");
        modal.style.display = "flex";

        // Klik tombol login
        document.getElementById("btnLogin").onclick = () => {
          window.location.href = "login.html";
        };

        // Auto redirect 2 detik
        setTimeout(() => {
          window.location.href = "login.html";
        }, 2000);
      }
    });
  </script>
</body>
</html>
